{
    "sourceFile": "frontend/src/lib/pensionEngine.test.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1768749681388,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1768771060212,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,72 @@\n+import { generatePayments, Payment, PensionResult } from './pensionEngine';\r\n+\r\n+describe('pensionEngine', () => {\r\n+    const mockBankHolidays: Record<string, string> = {\r\n+        '2025-12-25': 'Christmas Day',\r\n+        '2025-12-26': 'Boxing Day',\r\n+        '2026-01-01': 'New Year\\'s Day',\r\n+    };\r\n+\r\n+    describe('generatePayments', () => {\r\n+        it('should generate payments for a valid NI number', () => {\r\n+            const result = generatePayments('00A', 2025, 2025, 28, mockBankHolidays);\r\n+            expect(result.ni).toBe('00A');\r\n+            expect(result.cycleDays).toBe(28);\r\n+            expect(result.normalDay).toBe('Monday');\r\n+            expect(result.payments.length).toBeGreaterThan(0);\r\n+        });\r\n+\r\n+        it('should throw for invalid cycleDays', () => {\r\n+            expect(() => generatePayments('00A', 2025, 2025, 10)).toThrow('Invalid cycleDays');\r\n+        });\r\n+\r\n+        it('should support 7-day cycle', () => {\r\n+            const result = generatePayments('00A', 2025, 2025, 7);\r\n+            expect(result.cycleDays).toBe(7);\r\n+            expect(result.payments.length).toBeGreaterThan(0);\r\n+        });\r\n+\r\n+        it('should support 14-day cycle', () => {\r\n+            const result = generatePayments('00A', 2025, 2025, 14);\r\n+            expect(result.cycleDays).toBe(14);\r\n+        });\r\n+\r\n+        it('should mark early payments before bank holidays', () => {\r\n+            const result = generatePayments('00A', 2025, 2026, 28, mockBankHolidays);\r\n+            const earlyPayment = result.payments.find(p => p.early);\r\n+            expect(earlyPayment).toBeDefined();\r\n+            expect(earlyPayment?.holidays?.length).toBeGreaterThan(0);\r\n+        });\r\n+\r\n+        it('should generate payments within specified year range', () => {\r\n+            const result = generatePayments('00A', 2025, 2025, 28);\r\n+            result.payments.forEach(payment => {\r\n+                const year = parseInt(payment.paid.split('-')[0]);\r\n+                expect(year).toBeLessThanOrEqual(2025);\r\n+            });\r\n+        });\r\n+\r\n+        it('should handle different NI letters (A-D)', () => {\r\n+            const resultA = generatePayments('00A', 2025, 2025, 28);\r\n+            const resultB = generatePayments('00B', 2025, 2025, 28);\r\n+            expect(resultA.normalDay).not.toBe(resultB.normalDay);\r\n+        });\r\n+\r\n+        it('should return payments in chronological order', () => {\r\n+            const result = generatePayments('00A', 2025, 2026, 28);\r\n+            for (let i = 1; i < result.payments.length; i++) {\r\n+                expect(result.payments[i].paid).toGreaterThan(result.payments[i - 1].paid);\r\n+            }\r\n+        });\r\n+\r\n+        it('should maintain cycle day spacing between payments', () => {\r\n+            const result = generatePayments('05C', 2025, 2025, 28);\r\n+            for (let i = 1; i < result.payments.length; i++) {\r\n+                const date1 = new Date(result.payments[i - 1].paid);\r\n+                const date2 = new Date(result.payments[i].paid);\r\n+                const diffDays = (date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24);\r\n+                expect(diffDays).toBe(28);\r\n+            }\r\n+        });\r\n+    });\r\n+});\n\\ No newline at end of file\n"
                },
                {
                    "date": 1768771067755,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,65 +68,5 @@\n                 expect(diffDays).toBe(28);\r\n             }\r\n         });\r\n     });\r\n-});\n-import { describe, it, expect } from 'vitest';\r\n-import { getPaymentWeekdayFromNI } from './pensionEngine';\r\n-\r\n-describe('getPaymentWeekdayFromNI', () => {\r\n-    it('returns Monday for NI numbers 00-19', () => {\r\n-        expect(getPaymentWeekdayFromNI('10A')).toEqual({\r\n-            jsWeekday: 1,\r\n-            weekdayName: 'Monday'\r\n-        });\r\n-        expect(getPaymentWeekdayFromNI('19B')).toEqual({\r\n-            jsWeekday: 1,\r\n-            weekdayName: 'Monday'\r\n-        });\r\n-    });\r\n-\r\n-    it('returns Tuesday for NI numbers 20-39', () => {\r\n-        expect(getPaymentWeekdayFromNI('25C')).toEqual({\r\n-            jsWeekday: 2,\r\n-            weekdayName: 'Tuesday'\r\n-        });\r\n-        expect(getPaymentWeekdayFromNI('39D')).toEqual({\r\n-            jsWeekday: 2,\r\n-            weekdayName: 'Tuesday'\r\n-        });\r\n-    });\r\n-\r\n-    it('returns Wednesday for NI numbers 40-59', () => {\r\n-        expect(getPaymentWeekdayFromNI('50A')).toEqual({\r\n-            jsWeekday: 3,\r\n-            weekdayName: 'Wednesday'\r\n-        });\r\n-    });\r\n-\r\n-    it('returns Thursday for NI numbers 60-79', () => {\r\n-        expect(getPaymentWeekdayFromNI('70B')).toEqual({\r\n-            jsWeekday: 4,\r\n-            weekdayName: 'Thursday'\r\n-        });\r\n-    });\r\n-\r\n-    it('returns Friday for NI numbers 80+', () => {\r\n-        expect(getPaymentWeekdayFromNI('95C')).toEqual({\r\n-            jsWeekday: 5,\r\n-            weekdayName: 'Friday'\r\n-        });\r\n-    });\r\n-\r\n-    it('handles whitespace and lowercase input', () => {\r\n-        expect(getPaymentWeekdayFromNI('  15a  ')).toEqual({\r\n-            jsWeekday: 1,\r\n-            weekdayName: 'Monday'\r\n-        });\r\n-    });\r\n-\r\n-    it('throws error for invalid NI format', () => {\r\n-        expect(() => getPaymentWeekdayFromNI('INVALID')).toThrow('NI parsing failed');\r\n-        expect(() => getPaymentWeekdayFromNI('10')).toThrow('NI parsing failed');\r\n-        expect(() => getPaymentWeekdayFromNI('10E')).toThrow('NI parsing failed');\r\n-    });\r\n });\n\\ No newline at end of file\n"
                },
                {
                    "date": 1768771201753,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,72 +1,69 @@\n-import { generatePayments, Payment, PensionResult } from './pensionEngine';\r\n+import { generatePayments } from \"./pensionEngine\";\r\n+import type { BankHolidayMap } from \"./fetchBankHolidays\";\r\n \r\n-describe('pensionEngine', () => {\r\n-    const mockBankHolidays: Record<string, string> = {\r\n-        '2025-12-25': 'Christmas Day',\r\n-        '2025-12-26': 'Boxing Day',\r\n-        '2026-01-01': 'New Year\\'s Day',\r\n-    };\r\n+/* ------------------------------------------------------------\r\n+   MOCK BANK HOLIDAYS (known real dates)\r\n+------------------------------------------------------------ */\r\n+const bankHolidays: BankHolidayMap = {\r\n+  \"2026-01-05\": \"New Year (substitute)\", // Monday\r\n+  \"2026-04-03\": \"Good Friday\",\r\n+  \"2026-04-06\": \"Easter Monday\"\r\n+};\r\n \r\n-    describe('generatePayments', () => {\r\n-        it('should generate payments for a valid NI number', () => {\r\n-            const result = generatePayments('00A', 2025, 2025, 28, mockBankHolidays);\r\n-            expect(result.ni).toBe('00A');\r\n-            expect(result.cycleDays).toBe(28);\r\n-            expect(result.normalDay).toBe('Monday');\r\n-            expect(result.payments.length).toBeGreaterThan(0);\r\n-        });\r\n+/* ------------------------------------------------------------\r\n+   TEST CASES\r\n+------------------------------------------------------------ */\r\n+const tests = [\r\n+  {\r\n+    name: \"29B – Tuesday payments\",\r\n+    ni: \"29B\",\r\n+    startYear: 2024,\r\n+    endYear: 2026,\r\n+    expectedWeekday: \"Tuesday\",\r\n+    firstPayment2024: \"2024-01-02\"\r\n+  },\r\n+  {\r\n+    name: \"84D – Friday payments\",\r\n+    ni: \"84D\",\r\n+    startYear: 2024,\r\n+    endYear: 2026,\r\n+    expectedWeekday: \"Friday\",\r\n+    firstPayment2024: \"2024-01-05\"\r\n+  }\r\n+];\r\n \r\n-        it('should throw for invalid cycleDays', () => {\r\n-            expect(() => generatePayments('00A', 2025, 2025, 10)).toThrow('Invalid cycleDays');\r\n-        });\r\n+/* ------------------------------------------------------------\r\n+   RUN TESTS\r\n+------------------------------------------------------------ */\r\n+for (const t of tests) {\r\n+  const result = generatePayments(\r\n+    t.ni,\r\n+    t.startYear,\r\n+    t.endYear,\r\n+    28,\r\n+    bankHolidays\r\n+  );\r\n \r\n-        it('should support 7-day cycle', () => {\r\n-            const result = generatePayments('00A', 2025, 2025, 7);\r\n-            expect(result.cycleDays).toBe(7);\r\n-            expect(result.payments.length).toBeGreaterThan(0);\r\n-        });\r\n+  console.group(t.name);\r\n \r\n-        it('should support 14-day cycle', () => {\r\n\\ No newline at end of file\n-            const result = generatePayments('00A', 2025, 2025, 14);\r\n-            expect(result.cycleDays).toBe(14);\r\n-        });\r\n+  console.log(\"Normal day:\", result.normalDay);\r\n+  console.log(\"First payment:\", result.payments[0]?.paid);\r\n \r\n-        it('should mark early payments before bank holidays', () => {\r\n-            const result = generatePayments('00A', 2025, 2026, 28, mockBankHolidays);\r\n-            const earlyPayment = result.payments.find(p => p.early);\r\n-            expect(earlyPayment).toBeDefined();\r\n-            expect(earlyPayment?.holidays?.length).toBeGreaterThan(0);\r\n-        });\r\n+  if (result.normalDay !== t.expectedWeekday) {\r\n+    console.error(\r\n+      `❌ Weekday mismatch: expected ${t.expectedWeekday}`\r\n+    );\r\n+  } else {\r\n+    console.log(\"✅ Weekday OK\");\r\n+  }\r\n \r\n-        it('should generate payments within specified year range', () => {\r\n-            const result = generatePayments('00A', 2025, 2025, 28);\r\n-            result.payments.forEach(payment => {\r\n-                const year = parseInt(payment.paid.split('-')[0]);\r\n-                expect(year).toBeLessThanOrEqual(2025);\r\n-            });\r\n-        });\r\n+  if (result.payments[0]?.paid !== t.firstPayment2024) {\r\n+    console.error(\r\n+      `❌ First payment wrong: expected ${t.firstPayment2024}`\r\n+    );\r\n+  } else {\r\n+    console.log(\"✅ First payment OK\");\r\n+  }\r\n \r\n-        it('should handle different NI letters (A-D)', () => {\r\n-            const resultA = generatePayments('00A', 2025, 2025, 28);\r\n-            const resultB = generatePayments('00B', 2025, 2025, 28);\r\n-            expect(resultA.normalDay).not.toBe(resultB.normalDay);\r\n-        });\r\n-\r\n-        it('should return payments in chronological order', () => {\r\n-            const result = generatePayments('00A', 2025, 2026, 28);\r\n-            for (let i = 1; i < result.payments.length; i++) {\r\n-                expect(result.payments[i].paid).toGreaterThan(result.payments[i - 1].paid);\r\n-            }\r\n-        });\r\n-\r\n-        it('should maintain cycle day spacing between payments', () => {\r\n-            const result = generatePayments('05C', 2025, 2025, 28);\r\n-            for (let i = 1; i < result.payments.length; i++) {\r\n-                const date1 = new Date(result.payments[i - 1].paid);\r\n-                const date2 = new Date(result.payments[i].paid);\r\n-                const diffDays = (date2.getTime() - date1.getTime()) / (1000 * 60 * 60 * 24);\r\n-                expect(diffDays).toBe(28);\r\n-            }\r\n-        });\r\n-    });\r\n-});\n+  console.groupEnd();\r\n+}\r\n"
                }
            ],
            "date": 1768749681388,
            "name": "Commit-0",
            "content": "import { describe, it, expect } from 'vitest';\r\nimport { getPaymentWeekdayFromNI } from './pensionEngine';\r\n\r\ndescribe('getPaymentWeekdayFromNI', () => {\r\n    it('returns Monday for NI numbers 00-19', () => {\r\n        expect(getPaymentWeekdayFromNI('10A')).toEqual({\r\n            jsWeekday: 1,\r\n            weekdayName: 'Monday'\r\n        });\r\n        expect(getPaymentWeekdayFromNI('19B')).toEqual({\r\n            jsWeekday: 1,\r\n            weekdayName: 'Monday'\r\n        });\r\n    });\r\n\r\n    it('returns Tuesday for NI numbers 20-39', () => {\r\n        expect(getPaymentWeekdayFromNI('25C')).toEqual({\r\n            jsWeekday: 2,\r\n            weekdayName: 'Tuesday'\r\n        });\r\n        expect(getPaymentWeekdayFromNI('39D')).toEqual({\r\n            jsWeekday: 2,\r\n            weekdayName: 'Tuesday'\r\n        });\r\n    });\r\n\r\n    it('returns Wednesday for NI numbers 40-59', () => {\r\n        expect(getPaymentWeekdayFromNI('50A')).toEqual({\r\n            jsWeekday: 3,\r\n            weekdayName: 'Wednesday'\r\n        });\r\n    });\r\n\r\n    it('returns Thursday for NI numbers 60-79', () => {\r\n        expect(getPaymentWeekdayFromNI('70B')).toEqual({\r\n            jsWeekday: 4,\r\n            weekdayName: 'Thursday'\r\n        });\r\n    });\r\n\r\n    it('returns Friday for NI numbers 80+', () => {\r\n        expect(getPaymentWeekdayFromNI('95C')).toEqual({\r\n            jsWeekday: 5,\r\n            weekdayName: 'Friday'\r\n        });\r\n    });\r\n\r\n    it('handles whitespace and lowercase input', () => {\r\n        expect(getPaymentWeekdayFromNI('  15a  ')).toEqual({\r\n            jsWeekday: 1,\r\n            weekdayName: 'Monday'\r\n        });\r\n    });\r\n\r\n    it('throws error for invalid NI format', () => {\r\n        expect(() => getPaymentWeekdayFromNI('INVALID')).toThrow('NI parsing failed');\r\n        expect(() => getPaymentWeekdayFromNI('10')).toThrow('NI parsing failed');\r\n        expect(() => getPaymentWeekdayFromNI('10E')).toThrow('NI parsing failed');\r\n    });\r\n});"
        }
    ]
}